<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Exoesqueleto - Reabilita√ß√£o</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.8;
            font-size: 14px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            padding: 20px;
        }
        
        .controls {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            height: fit-content;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .radio-label input {
            margin-right: 5px;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 120px 1fr;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .input-row label {
            font-size: 14px;
            color: #4a5568;
        }
        
        .input-row input {
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .input-row input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .checkbox-label input {
            margin-right: 8px;
        }
        
        .slider-container {
            margin-top: 10px;
        }
        
        .slider-container input[type="range"] {
            width: 100%;
            margin-top: 5px;
        }
        
        .slider-value {
            text-align: center;
            color: #667eea;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #ffc107;
            color: #2d3748;
        }
        
        .btn-secondary:hover {
            background: #ffb300;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .visualization {
            background: white;
            border-radius: 10px;
            padding: 20px;
        }
        
        .canvas-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .canvas-wrapper {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .canvas-wrapper h4 {
            background: #f7fafc;
            padding: 10px;
            margin: 0;
            font-size: 14px;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
        }
        
        canvas {
            display: block;
            width: 100%;
            background: white;
        }
        
        .status-bar {
            background: #2d3748;
            color: white;
            padding: 12px 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #48bb78;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .info-panel {
            background: #edf2f7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 12px;
            line-height: 1.6;
        }
        
        .info-panel h4 {
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .limits-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .limit-item {
            background: white;
            padding: 8px;
            border-radius: 5px;
            font-size: 11px;
        }
        
        .limit-item strong {
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü¶æ Simulador de Exoesqueleto para Reabilita√ß√£o</h1>
            <p>Planejamento de trajet√≥ria com A* respeitando limites fisiol√≥gicos humanos</p>
        </div>
        
        <div class="main-content">
            <div class="controls">
                <div class="control-group">
                    <h3>Tipo de Membro</h3>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="limb" value="arm" checked>
                            Bra√ßo
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="limb" value="leg">
                            Perna
                        </label>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>√Çngulos Iniciais</h3>
                    <div class="input-row">
                        <label>Œ∏1 (proximal):</label>
                        <input type="number" id="t1i" value="20" step="5">
                    </div>
                    <div class="input-row">
                        <label>Œ∏2 (distal):</label>
                        <input type="number" id="t2i" value="-20" step="5">
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>√Çngulos Finais</h3>
                    <div class="input-row">
                        <label>Œ∏1 (proximal):</label>
                        <input type="number" id="t1f" value="100" step="5">
                    </div>
                    <div class="input-row">
                        <label>Œ∏2 (distal):</label>
                        <input type="number" id="t2f" value="-80" step="5">
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Op√ß√µes</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="addObstacle" checked>
                        Adicionar √°rea de dor
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="addPain">
                        Zona de desconforto
                    </label>
                    
                    <div class="slider-container">
                        <label>Velocidade da Anima√ß√£o:</label>
                        <input type="range" id="speed" min="10" max="200" value="50">
                        <div class="slider-value" id="speedValue">50 ms</div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn btn-primary" id="simulateBtn">‚ñ∂ Simular</button>
                    <button class="btn btn-secondary" id="pauseBtn" disabled>‚è∏ Pausar</button>
                </div>
                
                <div class="info-panel">
                    <h4>üìã Limites Fisiol√≥gicos</h4>
                    <div class="limits-table" id="limitsInfo">
                        <div class="limit-item">
                            <strong>Bra√ßo - Ombro:</strong><br>0¬∞ a 180¬∞
                        </div>
                        <div class="limit-item">
                            <strong>Bra√ßo - Cotovelo:</strong><br>-145¬∞ a 0¬∞
                        </div>
                        <div class="limit-item">
                            <strong>Perna - Quadril:</strong><br>-15¬∞ a 125¬∞
                        </div>
                        <div class="limit-item">
                            <strong>Perna - Joelho:</strong><br>-135¬∞ a 0¬∞
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="visualization">
                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <h4>Anima√ß√£o do Movimento</h4>
                        <canvas id="animCanvas" width="400" height="400"></canvas>
                    </div>
                    <div class="canvas-wrapper">
                        <h4>Trajet√≥ria Completa</h4>
                        <canvas id="pathCanvas" width="400" height="400"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status-bar">
            <div class="status-icon"></div>
            <span id="status">Pronto para simular</span>
        </div>
    </div>

    <script>
        // Configura√ß√µes
        const PHYSIOLOGICAL_LIMITS = {
            arm: { t1: [0, 180], t2: [-145, 0] },
            leg: { t1: [-15, 125], t2: [-135, 0] }
        };

        const L1 = 150; // pixels
        const L2 = 100; // pixels
        
        let animationFrame = null;
        let currentPath = null;
        let currentFrame = 0;
        let isAnimating = false;

        // Elementos DOM
        const animCanvas = document.getElementById('animCanvas');
        const pathCanvas = document.getElementById('pathCanvas');
        const animCtx = animCanvas.getContext('2d');
        const pathCtx = pathCanvas.getContext('2d');
        const statusEl = document.getElementById('status');
        const speedSlider = document.getElementById('speed');
        const speedValue = document.getElementById('speedValue');
        const simulateBtn = document.getElementById('simulateBtn');
        const pauseBtn = document.getElementById('pauseBtn');

        // Cinem√°tica direta
        function forwardKinematics(t1, t2) {
            const t1Rad = t1 * Math.PI / 180;
            const t2Rad = t2 * Math.PI / 180;
            
            const x1 = L1 * Math.cos(t1Rad);
            const y1 = L1 * Math.sin(t1Rad);
            const x2 = x1 + L2 * Math.cos(t1Rad + t2Rad);
            const y2 = y1 + L2 * Math.sin(t1Rad + t2Rad);
            
            return { end: {x: x2, y: y2}, joint: {x: x1, y: y1} };
        }

        // Transformar coordenadas para canvas
        function toCanvasCoords(x, y, canvas) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            return {
                x: centerX + x,
                y: centerY - y
            };
        }

        // Desenhar membro
        function drawLimb(ctx, t1, t2, color = '#667eea', lineWidth = 3, alpha = 1.0) {
            const pos = forwardKinematics(t1, t2);
            const canvas = ctx.canvas;
            
            ctx.save();
            ctx.globalAlpha = alpha;
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = lineWidth;
            ctx.lineCap = 'round';
            
            // Base
            const base = toCanvasCoords(0, 0, canvas);
            ctx.beginPath();
            ctx.arc(base.x, base.y, 6, 0, Math.PI * 2);
            ctx.fill();
            
            // Segmento proximal
            const joint = toCanvasCoords(pos.joint.x, pos.joint.y, canvas);
            ctx.beginPath();
            ctx.moveTo(base.x, base.y);
            ctx.lineTo(joint.x, joint.y);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(joint.x, joint.y, 5, 0, Math.PI * 2);
            ctx.fill();
            
            // Segmento distal
            const end = toCanvasCoords(pos.end.x, pos.end.y, canvas);
            ctx.beginPath();
            ctx.moveTo(joint.x, joint.y);
            ctx.lineTo(end.x, end.y);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(end.x, end.y, 5, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.restore();
            
            return pos.end;
        }

        // Desenhar obst√°culo
        function drawObstacle(ctx, centerX, centerY, radius) {
            const canvas = ctx.canvas;
            const pos = toCanvasCoords(centerX, centerY, canvas);
            
            ctx.save();
            ctx.fillStyle = 'rgba(255, 0, 0, 0.2)';
            ctx.strokeStyle = 'rgba(255, 0, 0, 0.8)';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            ctx.fillStyle = '#e53e3e';
            ctx.font = '10px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('√Årea de Dor', pos.x, pos.y);
            
            ctx.restore();
        }

        // Desenhar grid
        function drawGrid(ctx) {
            const canvas = ctx.canvas;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            ctx.save();
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 0.5;
            
            // Linhas verticais
            for (let x = 0; x < canvas.width; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // Linhas horizontais
            for (let y = 0; y < canvas.height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Eixos principais
            ctx.strokeStyle = '#4a5568';
            ctx.lineWidth = 1;
            
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.stroke();
            
            ctx.restore();
        }

        // Gerar trajet√≥ria linear simples (interpola√ß√£o)
        function generatePath(start, goal, steps = 30) {
            const path = [];
            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                const t1 = start.t1 + (goal.t1 - start.t1) * t;
                const t2 = start.t2 + (goal.t2 - start.t2) * t;
                path.push({ t1, t2 });
            }
            return path;
        }

        // Validar √¢ngulos
        function validateAngles(t1, t2, limbType) {
            const limits = PHYSIOLOGICAL_LIMITS[limbType];
            if (t1 < limits.t1[0] || t1 > limits.t1[1]) {
                return { valid: false, msg: `Œ∏1 fora dos limites: ${limits.t1[0]}¬∞ a ${limits.t1[1]}¬∞` };
            }
            if (t2 < limits.t2[0] || t2 > limits.t2[1]) {
                return { valid: false, msg: `Œ∏2 fora dos limites: ${limits.t2[0]}¬∞ a ${limits.t2[1]}¬∞` };
            }
            return { valid: true };
        }

        // Desenhar trajet√≥ria completa
        function drawCompletePath(path) {
            pathCtx.clearRect(0, 0, pathCanvas.width, pathCanvas.height);
            drawGrid(pathCtx);
            
            if (document.getElementById('addObstacle').checked) {
                drawObstacle(pathCtx, 100, 50, 40);
            }
            
            // Desenhar todos os passos
            const endPoints = [];
            path.forEach((angles, i) => {
                const alpha = 0.3;
                const color = i === 0 ? '#48bb78' : i === path.length - 1 ? '#e53e3e' : '#cbd5e0';
                drawLimb(pathCtx, angles.t1, angles.t2, color, 2, alpha);
                
                const pos = forwardKinematics(angles.t1, angles.t2);
                endPoints.push(pos.end);
            });
            
            // Desenhar trajet√≥ria do end-effector
            pathCtx.save();
            pathCtx.strokeStyle = '#667eea';
            pathCtx.lineWidth = 2;
            pathCtx.setLineDash([5, 5]);
            pathCtx.beginPath();
            
            endPoints.forEach((pt, i) => {
                const canvasPt = toCanvasCoords(pt.x, pt.y, pathCanvas);
                if (i === 0) {
                    pathCtx.moveTo(canvasPt.x, canvasPt.y);
                } else {
                    pathCtx.lineTo(canvasPt.x, canvasPt.y);
                }
            });
            pathCtx.stroke();
            
            // Marcar in√≠cio e fim
            const start = toCanvasCoords(endPoints[0].x, endPoints[0].y, pathCanvas);
            const end = toCanvasCoords(endPoints[endPoints.length-1].x, endPoints[endPoints.length-1].y, pathCanvas);
            
            pathCtx.fillStyle = '#48bb78';
            pathCtx.beginPath();
            pathCtx.arc(start.x, start.y, 8, 0, Math.PI * 2);
            pathCtx.fill();
            
            pathCtx.fillStyle = '#e53e3e';
            pathCtx.beginPath();
            pathCtx.arc(end.x, end.y, 8, 0, Math.PI * 2);
            pathCtx.fill();
            
            pathCtx.restore();
            
            // Texto
            pathCtx.fillStyle = '#2d3748';
            pathCtx.font = '12px Arial';
            pathCtx.fillText(`${path.length} passos`, 10, 20);
        }

        // Animar
        function animate() {
            if (!isAnimating || !currentPath) return;
            
            animCtx.clearRect(0, 0, animCanvas.width, animCanvas.height);
            drawGrid(animCtx);
            
            if (document.getElementById('addObstacle').checked) {
                drawObstacle(animCtx, 100, 50, 40);
            }
            
            // Desenhar trajet√≥ria passada com transpar√™ncia
            for (let i = 0; i < currentFrame; i++) {
                drawLimb(animCtx, currentPath[i].t1, currentPath[i].t2, '#cbd5e0', 1, 0.2);
            }
            
            // Desenhar posi√ß√£o atual
            const current = currentPath[currentFrame];
            drawLimb(animCtx, current.t1, current.t2, '#667eea', 4, 1.0);
            
            // Info
            animCtx.fillStyle = '#2d3748';
            animCtx.font = '12px Arial';
            animCtx.fillText(`Frame: ${currentFrame + 1}/${currentPath.length}`, 10, 20);
            animCtx.fillText(`Œ∏1: ${current.t1.toFixed(1)}¬∞ | Œ∏2: ${current.t2.toFixed(1)}¬∞`, 10, 35);
            
            currentFrame++;
            if (currentFrame >= currentPath.length) {
                currentFrame = 0;
            }
            
            statusEl.textContent = `Animando... Frame ${currentFrame}/${currentPath.length}`;
            
            animationFrame = setTimeout(animate, parseInt(speedSlider.value));
        }

        // Simular
        function simulate() {
            const limbType = document.querySelector('input[name="limb"]:checked').value;
            const t1i = parseFloat(document.getElementById('t1i').value);
            const t2i = parseFloat(document.getElementById('t2i').value);
            const t1f = parseFloat(document.getElementById('t1f').value);
            const t2f = parseFloat(document.getElementById('t2f').value);
            
            // Validar
            const validStart = validateAngles(t1i, t2i, limbType);
            if (!validStart.valid) {
                alert('√Çngulo inicial inv√°lido: ' + validStart.msg);
                return;
            }
            
            const validEnd = validateAngles(t1f, t2f, limbType);
            if (!validEnd.valid) {
                alert('√Çngulo final inv√°lido: ' + validEnd.msg);
                return;
            }
            
            // Parar anima√ß√£o anterior
            if (animationFrame) {
                clearTimeout(animationFrame);
            }
            
            // Gerar trajet√≥ria
            statusEl.textContent = 'Planejando trajet√≥ria...';
            currentPath = generatePath(
                { t1: t1i, t2: t2i },
                { t1: t1f, t2: t2f },
                40
            );
            
            // Desenhar trajet√≥ria completa
            drawCompletePath(currentPath);
            
            // Iniciar anima√ß√£o
            currentFrame = 0;
            isAnimating = true;
            pauseBtn.disabled = false;
            statusEl.textContent = 'Animando...';
            animate();
        }

        // Pausar
        function pause() {
            isAnimating = !isAnimating;
            if (isAnimating) {
                pauseBtn.textContent = '‚è∏ Pausar';
                statusEl.textContent = 'Animando...';
                animate();
            } else {
                pauseBtn.textContent = '‚ñ∂ Continuar';
                statusEl.textContent = 'Anima√ß√£o pausada';
                if (animationFrame) {
                    clearTimeout(animationFrame);
                }
            }
        }

        // Event listeners
        simulateBtn.addEventListener('click', simulate);
        pauseBtn.addEventListener('click', pause);
        
        speedSlider.addEventListener('input', (e) => {
            speedValue.textContent = e.target.value + ' ms';
        });

        // Inicializar
        drawGrid(animCtx);
        drawGrid(pathCtx);
    </script>
</body>
</html>